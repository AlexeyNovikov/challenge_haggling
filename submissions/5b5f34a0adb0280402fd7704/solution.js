'use strict';const possibleOffers={273:[1,16,17,256,257,272],274:[1,2,16,17,18,256,257,258,272,273],275:[1,2,3,16,17,18,19,256,257,258,259,272,273,274],276:[1,2,3,4,16,17,18,19,20,256,257,258,259,260,272,273,274,275],289:[1,16,17,32,33,256,257,272,273,288],290:[1,2,16,17,18,32,33,34,256,257,258,272,273,274,288,289],291:[1,2,3,16,17,18,19,32,33,34,35,256,257,258,259,272,273,274,275,288,289,290],305:[1,16,17,32,33,48,49,256,257,272,273,288,289,304],306:[1,2,16,17,18,32,33,34,48,49,50,256,257,258,272,
273,274,288,289,290,304,305],321:[1,16,17,32,33,48,49,64,65,256,257,272,273,288,289,304,305,320],529:[1,16,17,256,257,272,273,512,513,528],530:[1,2,16,17,18,256,257,258,272,273,274,512,513,514,528,529],531:[1,2,3,16,17,18,19,256,257,258,259,272,273,274,275,512,513,514,515,528,529,530],545:[1,16,17,32,33,256,257,272,273,288,289,512,513,528,529,544],546:[1,2,16,17,18,32,33,34,256,257,258,272,273,274,288,289,290,512,513,514,528,529,530,544,545],561:[1,16,17,32,33,48,49,256,257,272,273,288,289,304,305,
512,513,528,529,544,545,560],785:[1,16,17,256,257,272,273,512,513,528,529,768,769,784],786:[1,2,16,17,18,256,257,258,272,273,274,512,513,514,528,529,530,768,769,770,784,785],801:[1,16,17,32,33,256,257,272,273,288,289,512,513,528,529,544,545,768,769,784,785,800],1041:[1,16,17,256,257,272,273,512,513,528,529,768,769,784,785,1024,1025,1040]},possibleValuations={273:[10,25,40,55,70,85,100,115,130,145,160,265,280,295,310,325,340,355,370,385,400,520,535,550,565,580,595,610,625,640,775,790,805,820,835,850,
865,880,1030,1045,1060,1075,1090,1105,1120,1285,1300,1315,1330,1345,1360,1540,1555,1570,1585,1600,1795,1810,1825,1840,2050,2065,2080,2305,2320,2560],274:[5,36,67,98,129,160,276,307,338,369,400,516,547,578,609,640,787,818,849,880,1027,1058,1089,1120,1298,1329,1360,1538,1569,1600,1809,1840,2049,2080,2320,2560],275:[19,66,113,160,259,306,353,400,546,593,640,786,833,880,1026,1073,1120,1313,1360,1553,1600,1793,1840,2080,2320,2560],276:[34,97,160,274,337,400,514,577,640,817,880,1057,1120,1297,1360,1537,
1600,1840,2080,2320,2560],289:[10,24,38,52,66,80,265,279,293,307,321,520,534,548,562,576,775,789,803,817,1030,1044,1058,1072,1285,1299,1313,1540,1554,1568,1795,1809,2050,2064,2305,2560],290:[5,20,35,50,65,80,516,531,546,561,576,1027,1042,1057,1072,1538,1553,1568,2049,2064,2560],291:[34,80,259,305,530,576,801,1026,1072,1297,1568,1793,2064,2560],305:[10,23,36,49,265,278,291,304,520,533,546,775,788,801,1030,1043,1056,1285,1298,1540,1553,1795,1808,2050,2305,2560],306:[5,34,275,304,516,545,786,1027,1056,
1297,1538,1808,2049,2560],321:[10,22,34,265,277,289,520,532,544,775,787,1030,1042,1285,1297,1540,1552,1795,2050,2305,2560],529:[10,25,40,55,70,85,100,115,130,145,160,264,279,294,309,324,339,354,369,384,518,533,548,563,578,593,608,772,787,802,817,832,1026,1041,1056,1280],530:[5,36,67,98,129,160,260,291,322,353,384,515,546,577,608,770,801,832,1025,1056,1280],531:[19,66,113,160,290,337,384,514,561,608,785,832,1056,1280],545:[10,24,38,52,66,80,264,278,292,306,320,518,532,546,560,772,786,800,1026,1040,
1280],546:[5,20,35,50,65,80,260,275,290,305,320,515,530,545,560,770,785,800,1025,1040,1280],561:[10,23,36,49,264,277,290,518,531,544,772,785,1026,1280],785:[10,25,40,55,70,85,100,115,130,145,160,263,278,293,308,323,338,353,368,516,531,546,561,576,769,784],786:[5,36,67,98,129,160,275,306,337,368,514,545,576,784],801:[10,24,38,52,66,80,263,277,291,305,516,530,544,769],1041:[10,25,40,55,70,85,100,115,130,145,160,262,277,292,307,322,337,352,514,529,544]},toInt=(a)=>(a[0]<<8)+(a[1]<<4)+a[2],fromInt=(a)=>
[a>>8,a>>4&15,a&15],at0=(a)=>a>>8,at1=(a)=>a>>4&15,at2=(a)=>a&15,cnt=(a)=>at0(a)+at1(a)+at2(a),differentItems=(a)=>(at0(a)?1:0)+(at1(a)?1:0)+(at2(a)?1:0),allEq=(a,c)=>{for(const b of a)if(b!==c)return!1;return!0},subset=(a,c)=>at0(a)>at0(c)||at1(a)>at1(c)||at2(a)>at2(c)?!1:at0(a)<at0(c)||at1(a)<at1(c)||at2(a)<at2(c)?!0:!1;
module.exports=class{constructor(a,c,b,e,l){this.me=a;this.counts=c;this.values=b;this.rounds=e;this.log=l;this.sentOffers=[];this.receivedOffers=[];this.maxOffered=0;this.offerSortFn=this.offerSortFn.bind(this);const d=toInt(this.values);this.possibleValuations=possibleValuations[`${toInt(c)}`].filter((a)=>a!==d);this.allPossibleValuations=this.possibleValuations.slice();this.possibleOffers=possibleOffers[`${toInt(c)}`].filter((a)=>0<this.value(a)).sort(this.offerSortFn);this.maxFairVal=this.value(this.possibleOffers[0]);
this.possibleOffers=this.possibleOffers.filter((a)=>this.value(a)>this.maxFairVal-3);1===a&&(0===b[0]&&0===b[1]?this.possibleOffers=this.possibleOffers.filter((a)=>0===at0(a)&&0===at1(a)):0===b[0]&&0===b[2]?this.possibleOffers=this.possibleOffers.filter((a)=>0===at0(a)&&0===at2(a)):0===b[1]&&0===b[2]?this.possibleOffers=this.possibleOffers.filter((a)=>0===at1(a)&&0===at2(a)):0===b[0]?this.possibleOffers=this.possibleOffers.filter((a)=>0===at0(a)):0===b[1]?this.possibleOffers=this.possibleOffers.filter((a)=>
0===at1(a)):0===b[2]&&(this.possibleOffers=this.possibleOffers.filter((a)=>0===at2(a))))}offerSortFn(a,c){var b=this.value(c)-this.value(a);if(0!==b)return b;b=this.possibleValuations.length?this.possibleValuations:this.allPossibleValuations;let e=0,l=0;for(var d of b)e+=this.hisValue(a,d),l+=this.hisValue(c,d);d=e-l;if(0!==d)return d;d=cnt(c)-cnt(a);return 0!==d?d:a-c}value(a){return at0(a)*this.values[0]+at1(a)*this.values[1]+at2(a)*this.values[2]}hisValue(a,c){return(this.counts[0]-at0(a))*at0(c)+
(this.counts[1]-at1(a))*at1(c)+(this.counts[2]-at2(a))*at2(c)}zeroProbability(a){const c=this.possibleValuations.length?this.possibleValuations:this.allPossibleValuations;let b=0;for(const e of c)1>this.hisValue(a,e)&&b++;return 100*b/c.length}offer(a){this.rounds--;if(!a){var c=this.possibleOffers.shift();this.sentOffers.push(c);return fromInt(c)}const b=toInt(a);a=this.value(b);if(10!==a&&!(a>=this.maxFairVal)){if(1===this.me&&1===this.rounds){var e=0,l=this.receivedOffers.slice();l.unshift(b);
for(var d of l){l=this.value(d);const a=this.value(e);l>=this.maxFairVal-4&&(l>a||l===a&&d===b)&&(e=d)}if(0!==e)return e===b?void 0:fromInt(e)}if(!this.sentOffers.includes(b)){if(0===this.rounds&&1===this.me)return 0<a?void 0:this.counts.slice();if(this.possibleValuations.length&&!this.receivedOffers.includes(b)&&this.receivedOffers.length){d=!0;if(1<=this.rounds)for(var f of this.receivedOffers)if(subset(b,f)){d=!1;break}d&&(this.possibleValuations=this.possibleValuations.filter((a)=>{const c=this.hisValue(b,
a);if(0===c)return!1;for(const b of this.receivedOffers)if(c>this.hisValue(b,a))return!1;return!0}))}this.possibleValuations.length&&(0===this.receivedOffers.length||allEq(this.receivedOffers,0))&&(f=differentItems(b),1===f?0<at0(b)?(this.possibleValuations=this.possibleValuations.filter((a)=>at0(a)<=at1(a)&&at0(a)<=at2(a)),1<this.counts[0]&&at0(b)===this.counts[0]&&(this.possibleValuations=this.possibleValuations.filter((a)=>0===at0(a)))):0<at1(b)?(this.possibleValuations=this.possibleValuations.filter((a)=>
at1(a)<=at0(a)&&at1(a)<=at2(a)),1<this.counts[1]&&at1(b)===this.counts[1]&&(this.possibleValuations=this.possibleValuations.filter((a)=>0===at1(a)))):(this.possibleValuations=this.possibleValuations.filter((a)=>at2(a)<=at0(a)&&at2(a)<=at1(a)),1<this.counts[2]&&at2(b)===this.counts[2]&&(this.possibleValuations=this.possibleValuations.filter((a)=>0===at2(a)))):2===f&&(0===at0(b)?at1(b)===this.counts[1]&&at2(b)===this.counts[2]&&(this.possibleValuations=this.possibleValuations.filter((a)=>0===at1(a)&&
0===at2(a))):0===at1(b)?at0(b)===this.counts[0]&&at2(b)===this.counts[2]&&(this.possibleValuations=this.possibleValuations.filter((a)=>0===at0(a)&&0===at2(a))):0===at2(b)&&at0(b)===this.counts[0]&&at1(b)===this.counts[1]&&(this.possibleValuations=this.possibleValuations.filter((a)=>0===at0(a)&&0===at1(a)))));if(this.sentOffers.length&&this.possibleValuations){const a=this.sentOffers[this.sentOffers.length-1];this.possibleValuations=this.possibleValuations.filter((b)=>10>this.hisValue(a,b))}this.receivedOffers.push(b);
a>this.maxOffered&&(this.maxOffered=a);this.possibleOffers=this.possibleOffers.filter((a)=>this.value(a)>=this.maxOffered&&99>this.zeroProbability(a)&&a!==b&&!subset(a,b));this.possibleOffers.sort(this.offerSortFn);if(0===this.rounds){f=this.receivedOffers.slice();f.sort(this.offerSortFn);a=f.shift();for(var h of f){f=this.value(h);if(f<this.value(a))break;if(f===this.value(a)&&h===b){a=h;break}}d=this.possibleValuations.length?this.possibleValuations:this.allPossibleValuations;h=Array(d.length);
f=0;for(e=0;e<h.length;e++){h[e]={pv:d[e],p:0};for(var k of this.receivedOffers)h[e].p+=this.hisValue(k,d[e]);f+=h[e].p}h.sort((a,b)=>a.p!==b.p?b.p-a.p:a.pv-b.pv);for(k=0;k<h.length;k++)h[k].p/=f;k=this.value(a);d=0;f=possibleOffers[`${toInt(this.counts)}`].slice();f=f.filter((a)=>!this.receivedOffers.includes(a));e=0;for(c of f)if(0<this.value(c)){f=0;for(var g of h)f=0===this.hisValue(c,g.pv)?f-k*g.p:f+(this.value(c)-k)*g.p;if(f>e||f===e&&this.value(c)>this.value(d))e=f,d=c}return 0<this.value(a)&&
this.value(a)>=this.value(d)?a===b?void 0:fromInt(a):0<this.value(d)?fromInt(d):fromInt(this.sentOffers[0])}c=0;if(0<this.possibleOffers.length)c=this.possibleOffers.shift();else if(0<this.sentOffers.length)[c]=this.sentOffers;else{c=!1;g=this.counts.slice();for(k=0;k<g.length;k++)0===this.values[k]&&(g[k]=0,c=!0);c||(this.values[0]<=this.values[1]&&this.values[0]<=this.values[2]?g[0]--:this.values[1]<=this.values[0]&&this.values[1]<=this.values[2]?g[1]--:this.values[2]<=this.values[0]&&this.values[2]<=
this.values[1]&&g[2]--);c=toInt(g);g=this.receivedOffers.slice();g.sort(this.offerSortFn);0<g.length&&this.value(g[0])>=this.value(c)&&([c]=g)}if(c!==b)return this.sentOffers.push(c),fromInt(c)}}}};
